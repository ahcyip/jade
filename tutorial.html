<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; jade 0.7.3 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="JADE Configuration" href="job_configuration.html" />
    <link rel="prev" title="Quick Start Guide" href="quickstart.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> jade
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Home page</a></li>
<li class="toctree-l1"><a class="reference internal" href="_autosummary/jade.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.cli.html">jade.cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.common.html">jade.common</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.enums.html">jade.enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.events.html">jade.events</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.exceptions.html">jade.exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.extensions.html">jade.extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.hpc.html">jade.hpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.jobs.html">jade.jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.loggers.html">jade.loggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.models.html">jade.models</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.resource_monitor.html">jade.resource_monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.result.html">jade.result</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.spark.html">jade.spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.test_common.html">jade.test_common</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.utils.html">jade.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jade.version.html">jade.version</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#computer-or-hpc-with-conda">Computer or HPC with conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#computer-with-docker">Computer with docker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#configure-jobs">Configure Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#submit-jobs">Submit Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#job-status">Job Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#job-results">Job Results</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cli-commands">CLI Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hpc-configuration">HPC Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-jobs">Configure Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cli-execution">CLI Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#job-execution">Job Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#job-status">Job Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="#canceling-jobs">Canceling Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#job-results">Job Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#failed-or-missing-jobs">Failed or Missing Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hpc-job-information">HPC Job information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resource-monitoring">Resource Monitoring</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="job_configuration.html">JADE Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="job_configuration.html#main-level">Main Level</a></li>
<li class="toctree-l2"><a class="reference internal" href="job_configuration.html#per-job-definition">Per-Job Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="job_configuration.html#submission-group-behaviors">Submission Group Behaviors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="submission_strategies.html">Job Submission Strategies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="submission_strategies.html#independent-short-multi-core-jobs">Independent, short, multi-core jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="submission_strategies.html#independent-short-single-core-jobs">Independent, short, single-core jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="submission_strategies.html#independent-single-core-jobs-with-variable-runtimes">Independent, single-core jobs with variable runtimes</a></li>
<li class="toctree-l2"><a class="reference internal" href="submission_strategies.html#jobs-that-require-different-submission-parameters">Jobs that require different submission parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="submission_strategies.html#jobs-that-require-multiple-nodes">Jobs that require multiple nodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Batch Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pipeline.html#create-the-pipeline">Create the pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipeline.html#customize-the-config">Customize the config</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipeline.html#submit-the-pipeline">Submit the pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipeline.html#check-status">Check status</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipeline.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spark_jobs.html">Spark Jobs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spark_jobs.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark_jobs.html#debugging-problems">Debugging Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark_jobs.html#compute-node-resource-monitoring">Compute Node Resource Monitoring</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="singularity_containers.html">Singularity Containers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="singularity_containers.html#building-a-container-that-can-be-used-for-hpc-submissions">Building a container that can be used for HPC submissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="singularity_containers.html#running-a-container-that-includes-jade">Running a container that includes JADE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="distributed_submission.html">Distributed Submission Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_usage.html">Advanced Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="advanced_usage.html#extending-jade">Extending JADE</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_usage.html#generic-command-extension">Generic Command Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_usage.html#demo-extension">Demo Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_usage.html#post-process">Post-process</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dev &amp; Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="jade.html">jade</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="design.html">JADE Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="design/classes.html">JADE Classes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="build_docs.html">Building the Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="build_docs.html#build-locally">Build locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_docs.html#push-to-github">Push to GitHub</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">jade</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This page describes how to use the JADE package to create, modify, and run
jobs locally or on an HPC.</p>
<section id="cli-commands">
<h2>CLI Commands<a class="headerlink" href="#cli-commands" title="Permalink to this headline">¶</a></h2>
<p>All CLI commands documented in this page have a hierarchical nature. There are
group commands followed by subcommands. You can enter <code class="docutils literal notranslate"><span class="pre">--help</span></code> at any level.
For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade --help
$ jade config --help
$ jade config hpc --help
</pre></div>
</div>
</section>
<section id="hpc-configuration">
<h2>HPC Configuration<a class="headerlink" href="#hpc-configuration" title="Permalink to this headline">¶</a></h2>
<p>This section only applies if you run your jobs on an HPC.</p>
<p>Change to a directory on the shared filesystem (such as /scratch on Eagle).
JADE uses the filesystem for internal synchronization.</p>
<section id="hpc-parameters">
<h3>HPC Parameters<a class="headerlink" href="#hpc-parameters" title="Permalink to this headline">¶</a></h3>
<p>You must define your HPC configuration in a settings file. Run this command
customized to your parameters.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade config hpc -a my-project -p short -t slurm -w <span class="s2">&quot;4:00:00&quot;</span> -c hpc.toml
Created HPC config file hpc_config.toml
</pre></div>
</div>
<p>All parameters have defaults, and so you can run <code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">config</span> <span class="pre">hpc</span></code> and then
edit the file afterwards.</p>
<p>The following parameters are optional when running on NREL’s HPC (Eagle):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">partition</span></code>: If not specified then the HPC will decide the partition based
on the wall time value (recommended unless you are using the <code class="docutils literal notranslate"><span class="pre">debug</span></code>
partition).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mem</span></code>: If specified then the HPC will only
provide nodes that have at least this amount of memory.  Refer to the HPC
documentation for supported formats. On Eagle: “80GB”, “150GB”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tmp</span></code>: If specified then the HPC will only provide nodes that have at least this
amount of storage space as scratch space. Refer to the HPC documentation for
supported formats. On Eagle: “500GB”, “2TB”.</p></li>
</ul>
<p>JADE was primarily designed to maximize use of compute node CPUs when running
jobs that only require a single node. Given that objective, the default value
of <code class="docutils literal notranslate"><span class="pre">nodes</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>JADE also supports setting <code class="docutils literal notranslate"><span class="pre">nodes</span></code>, <code class="docutils literal notranslate"><span class="pre">ntasks</span></code>, and <code class="docutils literal notranslate"><span class="pre">ntasks_per_node</span></code> to
allow users to run multi-node jobs. Refer to the HPC documentation and ensure
each job is compatible with the settings. Note that each job will be run on
every node simultaneously.</p>
<p>Refer to <a class="reference internal" href="submission_strategies.html#multi-node-job-strategy"><span class="std std-ref">Jobs that require multiple nodes</span></a> for an example of how to use JADE’s
multi-node feature.</p>
<p>Refer to <a class="reference internal" href="data_models.html#model-slurm-config"><span class="std std-ref">SlurmConfig</span></a> for a full list of parameters available
on NREL’s Eagle HPC with SLURM.</p>
<p>JADE will name each HPC job with this format: <code class="docutils literal notranslate"><span class="pre">&lt;job_prefix&gt;_batch_N</span></code> where
<code class="docutils literal notranslate"><span class="pre">job_prefix</span></code> is defined in <code class="docutils literal notranslate"><span class="pre">hpc_config.toml</span></code> and <code class="docutils literal notranslate"><span class="pre">N</span></code> is each batch index.
Customize <code class="docutils literal notranslate"><span class="pre">job_prefix</span></code> if you will be running multiple JADE batches and want
to be able to distinguish them.</p>
</section>
<section id="submission-groups">
<h3>Submission Groups<a class="headerlink" href="#submission-groups" title="Permalink to this headline">¶</a></h3>
<p>If you need different parameters for different jobs then you can separately
define submission groups in the configuration. Refer to
<a class="reference internal" href="submission_strategies.html#submission-group-strategy"><span class="std std-ref">Jobs that require different submission parameters</span></a> for more information.</p>
</section>
<section id="lustre-filesystem">
<h3>Lustre Filesystem<a class="headerlink" href="#lustre-filesystem" title="Permalink to this headline">¶</a></h3>
<p>If you are running on a Lustre filesystem then you should consider whether to
configure the Lustre stripe count. This can be beneficial if the the files you
create will be large or if many clients will be accessing them concurrently.</p>
<p>References:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://wiki.lustre.org/Configuring_Lustre_File_Striping">http://wiki.lustre.org/Configuring_Lustre_File_Striping</a></p></li>
<li><p><a class="reference external" href="https://www.nics.tennessee.edu/computing-resources/file-systems/lustre-striping-guide">https://www.nics.tennessee.edu/computing-resources/file-systems/lustre-striping-guide</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example Lustre filesystem command will only work if the directory is
empty.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ lfs setstripe -c <span class="m">16</span> &lt;run-directory&gt;
</pre></div>
</div>
</section>
</section>
<section id="configure-jobs">
<h2>Configure Jobs<a class="headerlink" href="#configure-jobs" title="Permalink to this headline">¶</a></h2>
<p>Create a text file with a list of commands, one per line.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat commands.txt
bash my_script.sh ARG1
bash my_script.sh ARG2
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Commands are not run through a shell, so you cannot use special
shell characters. You can workaround this by putting your command in a
shell script.</p>
</div>
<section id="job-commands">
<h3>Job Commands<a class="headerlink" href="#job-commands" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade config create commands.txt -c config.json
Created configuration with <span class="m">2</span> jobs.
Dumped configuration to config.json.
</pre></div>
</div>
<p>JADE created <code class="docutils literal notranslate"><span class="pre">config.json</span></code> with one definition per job. You can edit this
file to customize execution behavior.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can assign custom job names. This can make it easier to inspect results.</p>
</div>
<p>Refer to <a class="reference internal" href="job_configuration.html#model-generic-command-parameters"><span class="std std-ref">GenericCommandParameters</span></a> for a full list of
configurable parameters.</p>
</section>
<section id="add-blocking-jobs">
<h3>Add blocking jobs<a class="headerlink" href="#add-blocking-jobs" title="Permalink to this headline">¶</a></h3>
<p>A common use case is to include a post-processing job as the last job, and then make all
other jobs blocked by it. Here is one way to do that. This assumes that there are 5 jobs
and the last job is the post-processing job.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Job indexes are 0-based.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade config assign-blocked-by config.json <span class="m">4</span> -o new-config.json

<span class="c1"># These alternatives are identical.</span>
$ jade config assign-blocked-by config.json <span class="m">4</span> <span class="o">{</span><span class="m">0</span>..3<span class="o">}</span> -o new-config.json
$ jade config assign-blocked-by config.json <span class="m">4</span> <span class="m">0</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> -o new-config.json
</pre></div>
</div>
<p>Tip: Use this command to see the job indexes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade config show config.json
</pre></div>
</div>
</section>
<section id="create-a-config-programmatically">
<h3>Create a config programmatically<a class="headerlink" href="#create-a-config-programmatically" title="Permalink to this headline">¶</a></h3>
<p>If you are setting many custom parameters, it may be more convenient to create the
JADE configuration programmatically. An example is below. This will make the following customizations:</p>
<ul class="simple">
<li><p>Append the JADE runtime output directory to each command.</p></li>
<li><p>Make a final post-processing job dependent on the other jobs.</p></li>
<li><p>Set a custom name for each job.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jade.extensions.generic_command</span> <span class="kn">import</span> <span class="n">GenericCommandConfiguration</span><span class="p">,</span> <span class="n">GenericCommandParameters</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">GenericCommandConfiguration</span><span class="p">()</span>
<span class="n">base_cmd</span> <span class="o">=</span> <span class="s2">&quot;bash my_script.sh&quot;</span>
<span class="n">regular_job_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">base_cmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;job_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">GenericCommandParameters</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">append_output_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">append_job_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
    <span class="n">regular_job_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="n">post_process_job</span> <span class="o">=</span> <span class="n">GenericCommandParameters</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;bash run_post_process.sh&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;post_process&quot;</span><span class="p">,</span>
    <span class="n">append_output_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">append_job_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">blocked_by</span><span class="o">=</span><span class="n">regular_job_names</span><span class="p">,</span>
    <span class="n">cancel_on_blocking_job_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">post_process_job</span><span class="p">)</span>
<span class="n">config_file</span> <span class="o">=</span> <span class="s2">&quot;config.json&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is the result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ jade config show config.json
Num jobs: 4
+-------+--------------+--------------------------+------------------------+
| index |     name     |         command          | blocked_by (job names) |
+-------+--------------+--------------------------+------------------------+
|   0   |    job_1     |   bash my_script.sh 1    |                        |
|   1   |    job_2     |   bash my_script.sh 2    |                        |
|   2   |    job_3     |   bash my_script.sh 3    |                        |
|   3   | post_process | bash run_post_process.sh |  job_1, job_2, job_3   |
+-------+--------------+--------------------------+------------------------+
</pre></div>
</div>
</section>
<section id="job-ordering">
<h3>Job Ordering<a class="headerlink" href="#job-ordering" title="Permalink to this headline">¶</a></h3>
<p>Each job defines a <code class="docutils literal notranslate"><span class="pre">blocked_by</span></code> field. If you want to guarantee that job ID
2 doesn’t run until job ID 1 completes then add that ID to the field.</p>
<p>If a job that is blocking another job fails then JADE will still run the
blocked job by default. This may not be what you want. You can optionally set
<code class="docutils literal notranslate"><span class="pre">cancel_on_blocking_job_failure</span></code> to cause those blocked jobs to be canceled.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;job_cli_command1&gt;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;blocked_by&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;job_cli_command2&gt;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;blocked_by&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;job_cli_command3&gt;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="s2">&quot;blocked_by&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="s2">&quot;cancel_on_blocking_job_failure&quot;</span><span class="p">:</span> <span class="n">false</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;job_cli_command4&gt;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="s2">&quot;blocked_by&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
  <span class="s2">&quot;cancel_on_blocking_job_failure&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="show-job-summary">
<h3>Show Job Summary<a class="headerlink" href="#show-job-summary" title="Permalink to this headline">¶</a></h3>
<p>In order to view a summary of your jobs in a table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade config show config.json

Num jobs: <span class="m">4</span>
+-------+------+----------------+---------------------------+
<span class="p">|</span> index <span class="p">|</span> name <span class="p">|</span>    <span class="nb">command</span>     <span class="p">|</span>   blocked_by <span class="o">(</span>job names<span class="o">)</span>  <span class="p">|</span>
+-------+------+----------------+---------------------------+
<span class="p">|</span>   <span class="m">0</span>   <span class="p">|</span>  <span class="m">1</span>   <span class="p">|</span> julia run.jl <span class="m">1</span> <span class="p">|</span>                           <span class="p">|</span>
<span class="p">|</span>   <span class="m">1</span>   <span class="p">|</span>  <span class="m">2</span>   <span class="p">|</span> julia run.jl <span class="m">2</span> <span class="p">|</span>            <span class="m">1</span>              <span class="p">|</span>
<span class="p">|</span>   <span class="m">2</span>   <span class="p">|</span>  <span class="m">3</span>   <span class="p">|</span> julia run.jl <span class="m">3</span> <span class="p">|</span>            <span class="m">1</span>              <span class="p">|</span>
<span class="p">|</span>   <span class="m">3</span>   <span class="p">|</span>  <span class="m">4</span>   <span class="p">|</span> julia run.jl <span class="m">4</span> <span class="p">|</span>           <span class="m">2</span>, <span class="m">3</span>            <span class="p">|</span>
+-------+------+----------------+---------------------------+
</pre></div>
</div>
</section>
</section>
<section id="cli-execution">
<h2>CLI Execution<a class="headerlink" href="#cli-execution" title="Permalink to this headline">¶</a></h2>
<p>Jade provides a CLI utility to start jobs.</p>
<section id="submit-jobs">
<h3>submit-jobs<a class="headerlink" href="#submit-jobs" title="Permalink to this headline">¶</a></h3>
<p>Start execution of jobs defined in a configuration file.  If executed on HPC
this will submit the jobs to the HPC queue. Otherwise, it will run the jobs
locally.</p>
<p>It’s important to understand how JADE submits HPC jobs in order to optimize
your performance.  JADE divides the jobs created by the user into batches.  It
makes one HPC node submission for each batch. Once running on a node it runs in
parallel a number of worker processes equal to the number of CPUs on that node
(36 on Eagle).</p>
<p>Parameters to keep in mind:</p>
<ul class="simple">
<li><p><strong>Number of jobs</strong>: Number of jobs created by the user.</p></li>
<li><p><strong>Max nodes</strong>: Max number of job submissions (batches) to run in parallel.
Default is unbounded.</p></li>
<li><p><strong>Per-node batch size</strong>: Number of jobs to run on one node in one batch.</p></li>
<li><p><strong>Allocation time</strong>: How long it takes to acquire a node. Dependent on the
HPC queue chosen and the priority given.</p></li>
<li><p><strong>Average job runtime</strong>: How long it takes a job to complete.</p></li>
<li><p><strong>HPC config file</strong>: Customized HPC parameters like walltime and partition</p></li>
<li><p><strong>Time-based batching</strong>: If jobs have variable runtimes then it is better to
define those runtimes in the config file and then use the
<code class="docutils literal notranslate"><span class="pre">--time-based-batching</span></code> flag to let JADE create variable-sized batches.
Mutually exclusive with –per-node-batch-size.</p></li>
</ul>
<p>If the jobs have a short duration and it takes a long time to acquire a
node then you may want to maximize the value of per_node_batch_size. Conversely,
if the time to acquire a node is short then you can lower per_node_batch_size in
order to run on more nodes in parallel.</p>
<p>Refer to <a class="reference internal" href="submission_strategies.html#submission-strategies"><span class="std std-ref">Job Submission Strategies</span></a> for a description of how to handle
specific use cases.</p>
<p>Note that you can set different parameters for different batches if you define
submission groups. Refer to <a class="reference internal" href="submission_strategies.html#submission-group-strategy"><span class="std std-ref">Jobs that require different submission parameters</span></a> for more
information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can enable <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> to check how the batches will be created
without actually submitting any jobs.</p>
</div>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Use defaults.
$ jade submit-jobs config.json

# Specify options.
$ jade submit-jobs config.json \
    --output=output \
    --per-node-batch-size=500 \
    --hpc-config=hpc_config.toml
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">submit-jobs</span> <span class="pre">--help</span></code> to see all command options and defaults.</p>
<p>To aid with repeated runs you can pass these parameters in a config file.
Generate the defaults with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade config submitter-params

Created submitter parameter file submitter_params.toml
</pre></div>
</div>
<p>And then pass this file to <code class="docutils literal notranslate"><span class="pre">submit-jobs</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade submit-jobs config.json -s submitter_params.toml
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default HPC nodes are requested at normal priority. Set qos=high in
hpc_config.toml to get faster allocations at twice the cost.</p>
</div>
</section>
<section id="output-directory">
<h3>Output Directory<a class="headerlink" href="#output-directory" title="Permalink to this headline">¶</a></h3>
<p>JADE stores all of its configuration information and log files in the output
directory specified by the <code class="docutils literal notranslate"><span class="pre">submit-jobs</span></code> command. You can tell JADE to
forward this directory to the job CLI commands by setting the
<code class="docutils literal notranslate"><span class="pre">append_output_dir</span></code> and <code class="docutils literal notranslate"><span class="pre">append_job_name</span></code> job parameters to true.</p>
<p>Suppose you submit jobs with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jade submit-jobs config.json -o output
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">config.json</span></code> contains a job definition like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bash my_script.sh&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;blocked_by&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;append_output_dir&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;append_job_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>JADE will actually invoke this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ bash my_script.sh --jade-runtime-output<span class="o">=</span>output --jade-job-name<span class="o">=</span>job1
</pre></div>
</div>
<p>This can be useful to collect all job outputs in a common location. JADE
automatically creates <code class="docutils literal notranslate"><span class="pre">&lt;output-dir&gt;/job-outputs</span></code> for this purpose.</p>
<p>Your job can store its output files in <code class="docutils literal notranslate"><span class="pre">&lt;output-dir&gt;/job-outputs/job1</span></code></p>
</section>
<section id="node-setup-and-shutdown-scripts">
<h3>Node setup and shutdown scripts<a class="headerlink" href="#node-setup-and-shutdown-scripts" title="Permalink to this headline">¶</a></h3>
<p>When running on an HPC you might want to copy input files to each compute node
before running jobs and then upload output data afterwards. JADE provides
options to automate this process.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jade submit-jobs --node-setup-script<span class="o">=</span><span class="s2">&quot;python setup_node.py&quot;</span> --node-shutdown-script<span class="o">=</span><span class="s2">&quot;python shutdown_node.py&quot;</span> config.json
</pre></div>
</div>
<p>In this example JADE will invoke these commands on each compute node.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup_node.py config_batch1.json output-dir
python shutdown_node.py config_batch1.json output-dir
</pre></div>
</div>
<p>Note the arguments:</p>
<ol class="arabic simple">
<li><p>JADE config file for that node’s batch. It contains only the jobs in the
batch.</p></li>
<li><p>the output directory passed to <code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">submit-jobs</span></code></p></li>
</ol>
<p>You can use this information to decide what files to copy. Here is an example
of how to use it.</p>
<p>Pre-requisite: define required files for each in each job’s <code class="docutils literal notranslate"><span class="pre">ext</span></code> field.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bash my-script.sh&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;blocked_by&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;extension&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;generic_command&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;ext&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;required_files&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/projects/X/input_data.json&quot;</span><span class="p">]}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Here is what you can do in the setup script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">jade.jobs.job_configuration_factory</span> <span class="kn">import</span> <span class="n">create_config_from_file</span>

<span class="n">config_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">create_config_from_file</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
<span class="n">required_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">iter_jobs</span><span class="p">():</span>
    <span class="n">required_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required_files&quot;</span><span class="p">,</span> <span class="p">[])))</span>

<span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LOCAL_SCRATCH&quot;</span><span class="p">]</span>  <span class="c1"># or whatever is appropriate for your environment</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">required_files</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can define different setup/shutdown scripts for different jobs if
you define submission groups.</p>
</div>
</section>
</section>
<section id="job-execution">
<h2>Job Execution<a class="headerlink" href="#job-execution" title="Permalink to this headline">¶</a></h2>
<section id="hpc">
<h3>HPC<a class="headerlink" href="#hpc" title="Permalink to this headline">¶</a></h3>
<p>The job submitter runs in a distributed fashion across the login node and all
compute nodes that get allocated.</p>
<ol class="arabic simple">
<li><p>User initiates execution by running <code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">submit-jobs</span></code> on the login node.</p></li>
<li><p>JADE submits as many batches as possible and then exits. Jobs can be blocked
by ordering requirements or the user-specified max-node limit.</p></li>
<li><p>HPC queueing system allocates a compute node for a batch of jobs and starts
the JADE job runner process.</p></li>
<li><p>Both before and after running a batch of jobs the job runner will run
<code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">try-submit-jobs</span></code>. If it finds newly-unblocked jobs then it will
submit them in a new batch. This will occur on every allocated compute node.</p></li>
<li><p>When a submitter detects that all jobs are complete it will summarize
results and mark the configuration as complete.</p></li>
</ol>
<p>The JADE processes synchronize their activity with status files and a file lock
in the output directory.</p>
<p>Refer to <a class="reference internal" href="distributed_submission.html#distributed-submission-workflow"><span class="std std-ref">Distributed Submission Workflow</span></a> for a diagram of this process.</p>
</section>
<section id="local">
<h3>Local<a class="headerlink" href="#local" title="Permalink to this headline">¶</a></h3>
<p>JADE runs all jobs at the specified queue depth until they all complete.</p>
</section>
</section>
<section id="job-status">
<h2>Job Status<a class="headerlink" href="#job-status" title="Permalink to this headline">¶</a></h2>
<p>While jobs are running you can check status with this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade show-status -o output
</pre></div>
</div>
<p>The status is updated when each compute node starts or completes its execution
of a batch, so this status may not be current.</p>
<p>Each job runner will log completions to its own file, so you can see live job
completions with this command. Note that these files are cleared each time a
submitter processes them.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tail -F output/results/results_batch_1.csv
<span class="c1"># This will follow all files that exist, not ones yet to be created.</span>
$ tail -F output/results/results_batch_*.csv
</pre></div>
</div>
<p>Check processed jobs in this file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find out how many have completed.</span>
$ wc -l output/processed_results.csv

<span class="c1"># Follow updates.</span>
$ tail -f output/processed_results.csv
</pre></div>
</div>
<p>Every submitter will log to the same file, so you can monitor submission status
with this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tail -f output/submit-jobs.log
</pre></div>
</div>
<p>You can also trigger a full status update by manually trying to submit new
jobs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade try-submit-jobs output
$ jade show-status -o output
</pre></div>
</div>
</section>
<section id="canceling-jobs">
<h2>Canceling Jobs<a class="headerlink" href="#canceling-jobs" title="Permalink to this headline">¶</a></h2>
<p>You can cancel all jobs running in a submission with this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade cancel-jobs output
</pre></div>
</div>
</section>
<section id="job-results">
<h2>Job Results<a class="headerlink" href="#job-results" title="Permalink to this headline">¶</a></h2>
<p>Once execution is complete you can view the results of the jobs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade show-results --output<span class="o">=</span>output
</pre></div>
</div>
<p>Or only the ones that failed</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade show-results --failed
</pre></div>
</div>
</section>
<section id="failed-or-missing-jobs">
<h2>Failed or Missing Jobs<a class="headerlink" href="#failed-or-missing-jobs" title="Permalink to this headline">¶</a></h2>
<p>If some jobs fail because of a walltime timeout or code/data error then you can
resubmit those specific jobs without re-running all the jobs that passed.</p>
<p>Jobs that timeout will be reported as missing.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade resubmit-jobs --missing --failed output
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is currently not supported in local mode.</p>
</div>
</section>
<section id="hpc-job-information">
<h2>HPC Job information<a class="headerlink" href="#hpc-job-information" title="Permalink to this headline">¶</a></h2>
<section id="hours-used">
<h3>Hours Used<a class="headerlink" href="#hours-used" title="Permalink to this headline">¶</a></h3>
<p>Run this command after your jobs finish to see how many node hours you used.
Note that you can pass multiple output directories to accumulate jobs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade hpc-jobs show-times output-dir*

+------------+---------------------+---------------------+---------------------+----------+------------+-----------+--------+
<span class="p">|</span> hpc_job_id <span class="p">|</span>         name        <span class="p">|</span>        start        <span class="p">|</span>         end         <span class="p">|</span>  state   <span class="p">|</span>  account   <span class="p">|</span> partition <span class="p">|</span>  qos   <span class="p">|</span>
+------------+---------------------+---------------------+---------------------+----------+------------+-----------+--------+
<span class="p">|</span>  <span class="m">9040969</span>   <span class="p">|</span>   P11U_CBA_batch_1  <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">18</span>:58:17 <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">19</span>:01:32 <span class="p">|</span> <span class="nb">complete</span> <span class="p">|</span> distcosts3 <span class="p">|</span>   short   <span class="p">|</span> normal <span class="p">|</span>
<span class="p">|</span>  <span class="m">9040970</span>   <span class="p">|</span>   P11U_CBA_batch_2  <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">18</span>:58:17 <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">19</span>:02:04 <span class="p">|</span> <span class="nb">complete</span> <span class="p">|</span> distcosts3 <span class="p">|</span>   short   <span class="p">|</span> normal <span class="p">|</span>
<span class="p">|</span>  <span class="m">9040971</span>   <span class="p">|</span>   P11U_CBA_batch_3  <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">18</span>:58:17 <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">19</span>:02:39 <span class="p">|</span> <span class="nb">complete</span> <span class="p">|</span> distcosts3 <span class="p">|</span>   short   <span class="p">|</span> normal <span class="p">|</span>
<span class="p">|</span>  <span class="m">9040972</span>   <span class="p">|</span>   P11U_CBA_batch_4  <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">18</span>:58:17 <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">19</span>:01:17 <span class="p">|</span> <span class="nb">complete</span> <span class="p">|</span> distcosts3 <span class="p">|</span>   short   <span class="p">|</span> normal <span class="p">|</span>
<span class="p">|</span>  <span class="m">9040973</span>   <span class="p">|</span>   P11U_CBA_batch_5  <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">18</span>:58:17 <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">19</span>:01:22 <span class="p">|</span> <span class="nb">complete</span> <span class="p">|</span> distcosts3 <span class="p">|</span>   short   <span class="p">|</span> normal <span class="p">|</span>
<span class="p">|</span>  <span class="m">9041184</span>   <span class="p">|</span> P11U_CBA_pp_batch_1 <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">19</span>:10:26 <span class="p">|</span> <span class="m">2022</span>-04-15 <span class="m">19</span>:15:13 <span class="p">|</span> <span class="nb">complete</span> <span class="p">|</span> distcosts3 <span class="p">|</span>   short   <span class="p">|</span> normal <span class="p">|</span>
+------------+---------------------+---------------------+---------------------+----------+------------+-----------+--------+

Total <span class="nv">duration</span> <span class="o">=</span> <span class="m">1</span> day, <span class="m">2</span>:25:13
Total <span class="nv">hours</span> <span class="o">=</span> <span class="m">26</span>.42
</pre></div>
</div>
</section>
<section id="active-job-ids">
<h3>Active Job IDs<a class="headerlink" href="#active-job-ids" title="Permalink to this headline">¶</a></h3>
<p>You may want to run HPC-specific commands on job IDs to perform some action not directly supported by JADE.
You can run this command to see the active HPC job IDs (pending or running).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade hpc-jobs list-active-ids &lt;output-dir&gt;
</pre></div>
</div>
<p>Suppose you want to change the walltime value for each pending job. This example will work if your HPC
uses SLURM. (This will only work on pending jobs.)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="k">for</span> x <span class="k">in</span> <span class="sb">`</span>jade hpc-jobs list-active-ids &lt;output-dir&gt;<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> scontrol update <span class="nv">jobid</span><span class="o">=</span><span class="nv">$x</span> <span class="nv">TimeLimit</span><span class="o">=</span><span class="s2">&quot;24:00:00&quot;</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
</section>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>By default JADE generates report files that summarize what happened. Refer to
<code class="docutils literal notranslate"><span class="pre">results.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">errors.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">stats.txt</span></code>, and <code class="docutils literal notranslate"><span class="pre">stats_summary.json</span></code>.
The results file shows whether each job passed or failed.  The errors file
shows unhandled errors that JADE detected as well as known errors that it
parsed from log files.</p>
<p>Here are the log files that JADE generates. Open these to dig deeper.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">submit_jobs.log</span></code>: HPC-related information, such as the job ID and status</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_jobs.log</span></code>: information about JADE starting and stopping jobs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">job_output_&lt;HPC</span> <span class="pre">job</span> <span class="pre">ID&gt;.e</span></code>: The HPC logs stdout and stderr from all
processes to this file. Look here to debug unexpected crashes or hangs.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ find output -name <span class="s2">&quot;*.log&quot;</span> -o -name <span class="s2">&quot;*.e&quot;</span>
output/J1__3__1.15__1.0__deployment1.dss/logs/deployment1.dss_simulation.log
output/J1__3__1.15__1.0__deployment1.dss/pydss-project/Logs/pydss-project_deployment1.dss.log
output/submit_jobs.log
output/job_output_1151157.e
</pre></div>
</div>
<p>Python crashes will print <code class="docutils literal notranslate"><span class="pre">Traceback</span></code> to stderr, so that is a good string
to search for.</p>
<p>SLURM error strings:  <code class="docutils literal notranslate"><span class="pre">srun</span></code>, <code class="docutils literal notranslate"><span class="pre">slurmstepd</span></code>, <code class="docutils literal notranslate"><span class="pre">DUE</span> <span class="pre">TO</span> <span class="pre">TIME</span> <span class="pre">LIMIT</span></code></p>
<p>Useful grep commands</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ grep <span class="s2">&quot;WARNING\|ERROR&quot;</span> output/*log
$ grep -n <span class="s2">&quot;srun\|slurmstepd\|Traceback&quot;</span> output/*.e
</pre></div>
</div>
<section id="matching-jade-jobs-with-hpc-logs">
<h3>Matching JADE jobs with HPC logs<a class="headerlink" href="#matching-jade-jobs-with-hpc-logs" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above the HPC system captures stderr and stdout in <code class="docutils literal notranslate"><span class="pre">&lt;output-dir&gt;/job_output_&lt;HPC</span> <span class="pre">job</span> <span class="pre">ID&gt;.e</span></code>
and <code class="docutils literal notranslate"><span class="pre">&lt;output-dir&gt;/job_output_&lt;HPC</span> <span class="pre">job</span> <span class="pre">ID&gt;.o</span></code>. You may need to match JADE job IDs/names with these
files.</p>
<p>To help with this JADE records the HPC job ID for each job in <code class="docutils literal notranslate"><span class="pre">results.txt</span></code> (or <code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">show-results</span></code>).</p>
</section>
<section id="events">
<h3>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<p>If your extension implements JADE structured log events then you may want to
view what events were logged.</p>
<p>JADE will also log any unhandled exceptions here.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade show-events
$ jade show-events -c Error
</pre></div>
</div>
</section>
<section id="filtering-jobs">
<h3>Filtering jobs<a class="headerlink" href="#filtering-jobs" title="Permalink to this headline">¶</a></h3>
<p>You may want to debug a subset of the jobs.</p>
<p>Filter the first job into a new config file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade config filter config.json <span class="m">0</span> -o new_config.json
</pre></div>
</div>
<p>Filter ranges of indices of jobs into a new config file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade config filter config.json <span class="o">{</span><span class="m">0</span>..4<span class="o">}</span> <span class="o">{</span><span class="m">10</span>:14<span class="o">}</span> <span class="m">20</span> <span class="m">25</span> -o new_config.json
</pre></div>
</div>
</section>
<section id="deadlocks">
<h3>Deadlocks<a class="headerlink" href="#deadlocks" title="Permalink to this headline">¶</a></h3>
<p>While it should be very rare, it is possible that JADE gets deadlocked and
stops submitting jobs. When a compute node finishes a batch of jobs it acquires
a file lock in order to update status and attempt to submit new jobs. This
should usually take at most a few seconds. If a walltime timeout occurs while
this lock is held and the JADE process is terminated then no other node will be
able to promote itself to submitter and jobs will be stuck.</p>
<p>We plan to add code to detect this condition in the future. If this occurs
you can fix it manually by deleting the lock file and restarting jobs. This is
safe if you know that no new jobs were submitted. It is unsafe if one or more
jobs were submitted but not recorded. Restarting the jobs could result in the
same jobs being run multiple times.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ rm &lt;output-dir&gt;/cluster_config.json.lock
$ jade try-submit-jobs &lt;output-dir&gt;
</pre></div>
</div>
<p>If you would like to avoid the possibility of this happening then you can
pass <code class="docutils literal notranslate"><span class="pre">--no-distributed-submitter</span></code> to <code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">submit-jobs</span></code>. That will prevent
each compute node from updating status or looking for unblocked jobs to submit.
You will need to run the command <code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">try-submit-jobs</span></code> yourself to do this.</p>
<p>If you enable periodic resource utilization collection in this mode, be aware
of the fact that once JADE detects that all jobs are complete it will
aggregate the stats and generate plots in that process. This is
resource-intensive and you may not want to run it on the login node. You can
tell if this will occur beforehand by comparing the total number of jobs with
the number of completed jobs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will print the total number of jobs.</span>
$ jade config show config.json

<span class="c1"># This file lists the completed jobs and a header. Subtract one from this</span>
<span class="c1"># output to get the number of completed jobs.</span>
$ wc -l output/results.csv
</pre></div>
</div>
</section>
</section>
<section id="resource-monitoring">
<span id="id1"></span><h2>Resource Monitoring<a class="headerlink" href="#resource-monitoring" title="Permalink to this headline">¶</a></h2>
<p>JADE optionally monitors CPU, disk, memory, and network utilization
statistics in structured log events. There are two ways to collect statistics:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aggregation</span></code>: Track average/min/max stats in memory on each node and
generate a summary report at the end (default).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">periodic</span></code>: Record stats in files on each node and generate a summary
report and interactive HTML plots at the end. The reports include
average/min/max stats.</p></li>
</ol>
<p>You can specify the mode in <code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">submit-jobs</span></code> or <code class="docutils literal notranslate"><span class="pre">jade</span> <span class="pre">config</span>
<span class="pre">submitter-params</span></code>. Note the short and long forms of the option.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade submit-jobs config.json --resource-monitor-type<span class="o">=</span>aggregation
$ jade submit-jobs config.json -R aggregation
$ jade submit-jobs config.json --resource-monitor-type<span class="o">=</span>periodic
$ jade submit-jobs config.json -R periodic
$ jade submit-jobs config.json --resource-monitor-type<span class="o">=</span>none
$ jade submit-jobs config.json -R none
</pre></div>
</div>
<p>The option <code class="docutils literal notranslate"><span class="pre">--resource-monitor-interval</span></code> or <code class="docutils literal notranslate"><span class="pre">-r</span></code> (in seconds) applies to both modes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The periodic mode can generate large files if the compute nodes
run for a long time.</p>
</div>
<p>The default mode is <code class="docutils literal notranslate"><span class="pre">aggregation</span></code> in order to minimize storage consumption.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In order to preserve legacy behavior, if you specify
<code class="docutils literal notranslate"><span class="pre">--resource-monitor-interval</span></code> but not <code class="docutils literal notranslate"><span class="pre">resource-monitor-type</span></code>,
<code class="docutils literal notranslate"><span class="pre">periodic</span></code> will be used. This may change in the future.</p>
</div>
<p>Both modes will generate <code class="docutils literal notranslate"><span class="pre">&lt;output-dir&gt;/stats.txt</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;output-dir&gt;/stats_summary.json</span></code>.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">periodic</span></code> mode is enabled:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tree output/stats
output/stats
├── CpuStatsViewer__resource_monitor_batch_0.html
├── DiskStatsViewer__resource_monitor_batch_0.html
├── MemoryStatsViewer__resource_monitor_batch_0.html
└── NetworkStatsViewer__resource_monitor_batch_0.html
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/cpu.png" src="_images/cpu.png" />
</figure>
<figure class="align-default">
<img alt="_images/memory.png" src="_images/memory.png" />
</figure>
<p>Use this CLI command to view textual tables after a run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade stats show
$ jade stats show cpu
$ jade stats show disk
$ jade stats show mem
$ jade stats show net
$ jade stats show --summary-only
$ jade stats show --json-summary
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reads and writes to the Lustre filesystem on the HPC are not tracked.</p>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">--json-summary</span></code> option if you want to programmatically analyze the
average/minimum/maximum stats for each metric type.</p>
<p>The stats can also be provided as pandas.DataFrame objects. For example, here
is how to view CPU stats for the node that ran the first batch:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jade.events</span> <span class="kn">import</span> <span class="n">EventsSummary</span><span class="p">,</span> <span class="n">EVENT_NAME_CPU_STATS</span>
<span class="kn">from</span> <span class="nn">jade.resource_monitor</span> <span class="kn">import</span> <span class="n">CpuStatsViewer</span>

<span class="n">summary</span> <span class="o">=</span> <span class="n">EventsSummary</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
<span class="n">viewer</span> <span class="o">=</span> <span class="n">CpuStatsViewer</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">viewer</span><span class="o">.</span><span class="n">iter_batch_names</span><span class="p">():</span>
    <span class="n">cpu_df</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cpu_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<section id="standalone-resource-monitoring">
<h3>Standalone Resource Monitoring<a class="headerlink" href="#standalone-resource-monitoring" title="Permalink to this headline">¶</a></h3>
<p>The same resource monitoring functionality is available as a standalone script.
This can be useful to debug your application on your own system or in an interactive
session on a compute node. Here’s how to do it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ jade stats collect --interval<span class="o">=</span><span class="m">1</span> --output<span class="o">=</span>job-stats
<span class="c1"># Run your application in a separate terminal.</span>
<span class="c1"># Press Ctrl-c when your application is finished.</span>
$ jade stats plot --output<span class="o">=</span>job-stats
<span class="m">2021</span>-05-12 <span class="m">16</span>:59:48,367 - INFO <span class="o">[</span>jade.resource_monitor resource_monitor.py:226<span class="o">]</span> : Generated plot <span class="k">in</span> job-stats/stats/CpuStatsViewer__ResourceMonitor.html
<span class="m">2021</span>-05-12 <span class="m">16</span>:59:48,462 - INFO <span class="o">[</span>jade.resource_monitor resource_monitor.py:226<span class="o">]</span> : Generated plot <span class="k">in</span> job-stats/stats/DiskStatsViewer__ResourceMonitor.html
<span class="m">2021</span>-05-12 <span class="m">16</span>:59:48,541 - INFO <span class="o">[</span>jade.resource_monitor resource_monitor.py:226<span class="o">]</span> : Generated plot <span class="k">in</span> job-stats/stats/MemoryStatsViewer__ResourceMonitor.html
<span class="m">2021</span>-05-12 <span class="m">16</span>:59:48,629 - INFO <span class="o">[</span>jade.resource_monitor resource_monitor.py:226<span class="o">]</span> : Generated plot <span class="k">in</span> job-stats/stats/NetworkStatsViewer__ResourceMonitor.html
</pre></div>
</div>
<p>Open the interactive plots in a browser.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quick Start Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="job_configuration.html" class="btn btn-neutral float-right" title="JADE Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, NREL.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>